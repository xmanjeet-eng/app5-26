<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“ˆ Nifty 50 AI Predictor</title>
    <meta name="description" content="AI-powered Nifty 50 market analysis and predictions">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --gray: #64748b;
            --card-bg: rgba(30, 41, 59, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary), #7c3aed);
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="white" opacity="0.05"/></svg>');
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            position: relative;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
        }
        
        /* Control Buttons */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .btn i {
            font-size: 18px;
        }
        
        /* Prediction Card */
        .prediction-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .prediction-card.bullish {
            border-color: var(--success);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.2);
        }
        
        .prediction-card.bearish {
            border-color: var(--danger);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.2);
        }
        
        .prediction-card.neutral {
            border-color: var(--warning);
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.2);
        }
        
        .prediction-card.error {
            border-color: var(--danger);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .prediction-label {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            opacity: 0.8;
        }
        
        .prediction-value {
            font-size: 4.5rem;
            font-weight: 800;
            margin: 20px 0;
            line-height: 1;
        }
        
        .confidence-bar {
            width: 80%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 30px auto;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(30, 41, 59, 0.7);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Analysis Section */
        .analysis {
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 4px solid var(--primary);
        }
        
        .analysis h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Footer & Disclaimer */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
        }
        
        .disclaimer {
            background: rgba(239, 68, 68, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid rgba(239, 68, 68, 0.3);
            font-size: 0.95rem;
        }
        
        /* Loading Animation */
        .loader {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .prediction-value { font-size: 3rem; }
            .controls { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .container { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-chart-line"></i> Nifty 50 AI Predictor</h1>
            <p>Real-time market analysis & AI-powered predictions</p>
        </header>

        <!-- Controls -->
        <div class="controls">
            <button class="btn btn-primary" onclick="getPrediction()">
                <i class="fas fa-sync-alt"></i> Get Prediction
            </button>
            <button class="btn btn-secondary" onclick="toggleAutoRefresh()" id="autoRefreshBtn">
                <i class="fas fa-robot"></i> Auto Refresh (30s)
            </button>
            <button class="btn btn-secondary" onclick="showDetails()">
                <i class="fas fa-chart-bar"></i> View Details
            </button>
        </div>

        <!-- Prediction Card -->
        <div class="prediction-card" id="predictionCard">
            <div class="prediction-label" id="predictionLabel">Market Analysis</div>
            <div class="prediction-value" id="predictionValue">--</div>
            <div class="analysis" id="analysisText">
                Click "Get Prediction" to analyze current market conditions
            </div>
            
            <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceBar" style="width: 0%"></div>
            </div>
            <div style="margin-top: 10px;">
                <i class="fas fa-bullseye"></i> Confidence: <span id="confidenceText">0%</span>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Current Price</div>
                <div class="stat-value" id="currentPrice">--</div>
                <div class="stat-label" id="priceTime">--</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Today's Change</div>
                <div class="stat-value" id="todayChange">--</div>
                <div class="stat-label">vs Previous Close</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Expected Move</div>
                <div class="stat-value" id="expectedMove">--</div>
                <div class="stat-label">Next Session</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">Market Sentiment</div>
                <div class="stat-value" id="marketSentiment">--</div>
                <div class="stat-label" id="dataSource">--</div>
            </div>
        </div>

        <!-- Detailed Analysis -->
        <div class="analysis" id="detailedAnalysis" style="display: none;">
            <h3><i class="fas fa-microscope"></i> Detailed Analysis</h3>
            <div id="analysisDetails">
                <p><strong>RSI:</strong> <span id="rsiValue">--</span></p>
                <p><strong>Volume:</strong> <span id="volumeValue">--</span></p>
                <p><strong>Last Updated:</strong> <span id="lastUpdated">--</span></p>
                <p><strong>Prediction Model:</strong> Technical Analysis + AI</p>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <p><i class="fas fa-exclamation-triangle"></i> <strong>DISCLAIMER:</strong> 
            This tool is for educational and informational purposes only. Predictions are based on technical analysis and AI algorithms, not financial advice. Past performance does not guarantee future results. Always consult with a qualified financial advisor before making investment decisions.</p>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Nifty 50 AI Predictor v1.0 | Data updates every 5 minutes</p>
            <p>Â© 2024 Market Analysis Tool | Not affiliated with NSE or any financial institution</p>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let lastPrediction = null;

        // Format number with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Get prediction from API
        async function getPrediction() {
            const card = document.getElementById('predictionCard');
            const predictionValue = document.getElementById('predictionValue');
            const analysisText = document.getElementById('analysisText');
            
            // Show loading state
            card.classList.remove('bullish', 'bearish', 'neutral', 'error');
            card.classList.add('neutral');
            predictionValue.innerHTML = '<div class="loader"></div>';
            analysisText.textContent = 'Analyzing market data...';

            try {
                const response = await fetch('/api/predict');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                updateUI(data);
                lastPrediction = data;
                
            } catch (error) {
                console.error('Error:', error);
                card.classList.add('error');
                predictionValue.textContent = 'ERROR';
                analysisText.textContent = 'Failed to fetch prediction. Please check your connection and try again.';
                
                // Update with fallback data
                document.getElementById('currentPrice').textContent = 'â‚¹--';
                document.getElementById('todayChange').textContent = '--';
                document.getElementById('expectedMove').textContent = '--';
                document.getElementById('marketSentiment').textContent = '--';
                document.getElementById('confidenceText').textContent = '0%';
                document.getElementById('confidenceBar').style.width = '0%';
            }
        }

        // Update UI with prediction data
        function updateUI(data) {
            const card = document.getElementById('predictionCard');
            const predictionValue = document.getElementById('predictionValue');
            const analysisText = document.getElementById('analysisText');
            const confidenceBar = document.getElementById('confidenceBar');
            const confidenceText = document.getElementById('confidenceText');
            
            // Update prediction
            card.className = 'prediction-card ' + data.prediction.toLowerCase();
            predictionValue.textContent = data.prediction;
            analysisText.textContent = data.analysis;
            
            // Update confidence
            confidenceBar.style.width = data.confidence + '%';
            confidenceText.textContent = data.confidence + '%';
            
            // Update confidence bar color
            if (data.confidence >= 70) {
                confidenceBar.style.background = 'linear-gradient(90deg, var(--success), #34d399)';
            } else if (data.confidence >= 50) {
                confidenceBar.style.background = 'linear-gradient(90deg, var(--warning), #fbbf24)';
            } else {
                confidenceBar.style.background = 'linear-gradient(90deg, var(--danger), #f87171)';
            }
            
            // Update stats
            document.getElementById('currentPrice').textContent = data.current_price;
            document.getElementById('priceTime').textContent = 'Live';
            
            // Update today's change with color
            const todayChange = document.getElementById('todayChange');
            todayChange.textContent = data.today_change;
            if (data.today_change.includes('+')) {
                todayChange.style.color = 'var(--success)';
            } else if (data.today_change.includes('-')) {
                todayChange.style.color = 'var(--danger)';
            } else {
                todayChange.style.color = 'var(--warning)';
            }
            
            document.getElementById('expectedMove').textContent = data.expected_move;
            document.getElementById('marketSentiment').textContent = data.prediction;
            document.getElementById('dataSource').textContent = `Source: ${data.data_source}`;
            
            // Update detailed analysis if visible
            document.getElementById('rsiValue').textContent = data.rsi || '--';
            document.getElementById('volumeValue').textContent = data.volume || '--';
            document.getElementById('lastUpdated').textContent = data.timestamp;
            
            // Show notification
            showNotification(`Prediction updated: ${data.prediction}`);
        }

        // Toggle auto refresh
        function toggleAutoRefresh() {
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                btn.innerHTML = '<i class="fas fa-robot"></i> Auto Refresh (30s)';
                showNotification('Auto refresh disabled');
            } else {
                autoRefreshInterval = setInterval(getPrediction, 30000);
                btn.innerHTML = '<i class="fas fa-stop"></i> Stop Auto Refresh';
                showNotification('Auto refresh enabled - updates every 30s');
                
                // Get first prediction immediately
                getPrediction();
            }
        }

        // Show/hide detailed analysis
        function showDetails() {
            const details = document.getElementById('detailedAnalysis');
            if (details.style.display === 'none') {
                details.style.display = 'block';
                showNotification('Detailed analysis shown');
            } else {
                details.style.display = 'none';
            }
        }

        // Show notification
        function showNotification(message) {
            // Check if notification div exists
            let notification = document.querySelector('.notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--primary);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    z-index: 1000;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                `;
                document.body.appendChild(notification);
                
                // Add CSS for animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            notification.textContent = message;
            notification.style.display = 'block';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.5s ease';
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.animation = '';
                }, 500);
            }, 3000);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            getPrediction();
            
            // Add keyboard shortcut (Space for refresh)
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    getPrediction();
                }
                if (e.code === 'KeyA' && e.ctrlKey) {
                    e.preventDefault();
                    toggleAutoRefresh();
                }
            });
        });
    </script>
</body>
</html>
